<?xml version="1.0" encoding="UTF-8"?>

<!-- build script to create a plugin from org.eclipse.jdt.core -->
<project name="org.eclipse.jdt.core" default="export plug-in [_2.1.1]" basedir="..">

<target name="zz_init">
	<tstamp/>
	<property name="export-dir" value="../../plugin-export" />
	<property name="plugin-name" value="org.eclipse.jdt.core" />
</target>

<target name="export plug-in [_2.2.0]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir" value="${plugin-name}_2.2.0"/>
	</antcall>
</target>

<target name="export plug-in [_2.1.1]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir" value="${plugin-name}_2.1.1"/>
	</antcall>
</target>

<target name="export plug-in [_2.1.0]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir"  value="${plugin-name}_2.1.0"/>
	</antcall>
</target>

<target name="export plug-in [_2.1.0] (directory structure)" depends="zz_init">
	<antcall target="zz_internal_export_structure">
		<param name="bin_dest" value="${export-dir}/eclipse/plugins/${plugin-name}_2.1.0"/>
		<param name="src_dest" value="${export-dir}/eclipse/plugins/org.eclipse.jdt.source_2.1.0/src/${plugin-name}_2.1.0"/>
	</antcall>
</target>

<target name="export plug-in [_2.0.1]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir" value="${plugin-name}_2.0.1"/>
	</antcall>
</target>

<target name="export plug-in [_2.0.0]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir" value="${plugin-name}_2.0.0"/>
	</antcall>
</target>

<target name="export plug-in [_1.9.0]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir" value="${plugin-name}_1.9.0"/>
	</antcall>
</target>

<target name="export plug-in [no version]" depends="zz_init">
	<antcall target="zz_internal_export">
		<param name="plugin-dir" value="${plugin-name}"/>
	</antcall>
</target>

<target name="zz_internal_export">

	<tstamp/>

	<echo message="TARGET: ${export-dir}" />
	<mkdir dir="${export-dir}" />
	<delete dir="${export-dir}/${plugin-dir}" />
	<mkdir dir="${export-dir}/${plugin-dir}" />
	<delete file = "${export-dir}/../${plugin-dir}.zip" />
	
	<echo message="UPDATE jdtcore.jar" />
	<jar 
		jarfile="${export-dir}/${plugin-dir}/jdtcore.jar"
		basedir="bin" 
		excludes="**/JDTCompilerAdapter.class"/>
		
	<echo message="UPDATE jdtCompilerAdapter.jar" />
	<jar 
		jarfile="${export-dir}/${plugin-dir}/jdtCompilerAdapter.jar"
		basedir="bin" 
		includes="**/JDTCompilerAdapter.class"/>

	<echo message="UPDATE plugin.xml" />
	<copy file="plugin.xml" todir="${export-dir}/${plugin-dir}" />
	<echo message="UPDATE plugin.properties" />
	<copy file="plugin.properties" todir="${export-dir}/${plugin-dir}" />

	<echo message="UPDATE .options" />
	<copy file=".options" todir="${export-dir}/${plugin-dir}" />

	<echo message="UPDATE about.html" />
	<copy file="about.html" todir="${export-dir}/${plugin-dir}" />

	<echo message="UPDATE jdtcoresrc.zip" />
	<!--	produces a zip with source folder (need multi-rootpath support in source attachment - post 2.1)
		<zip zipfile="${export-dir}/${plugin-dir}/jdtcoresrc.zip"
		    basedir="."
			includes="batch/**, codeassist/**, compiler/**, dom/**, eval/**, formatter/**, model/**, search/**" />
	-->
	<zip zipfile="${export-dir}/${plugin-dir}/jdtcoresrc.zip">
	    <fileset dir="batch" />
	    <fileset dir="codeassist" />
	    <fileset dir="compiler" />
	    <fileset dir="dom" />
	    <fileset dir="eval" />
	    <fileset dir="formatter" />
	    <fileset dir="model" />
	    <fileset dir="search" />
	</zip>		

	<echo message="UPDATE jdtCompilerAdaptersrc.zip" />
	<zip zipfile="${export-dir}/${plugin-dir}/jdtCompilerAdaptersrc.zip"
	    basedir="antadapter" />
		
	<echo message="UPDATE ${export-dir}/../${plugin-dir}.zip" />
	<zip zipfile="${export-dir}/../${plugin-dir}.zip"
	    basedir="${export-dir}" 
	    includes="${plugin-dir}/**"	/>	    
</target>

<target name="zz_internal_export_structure">

	<tstamp/>

	<echo message="TARGET: ${export-dir}" />
	<mkdir dir="${export-dir}" />
	<delete dir="${bin_dest}" />
	<delete dir="${src_dest}" />
	<mkdir dir="${bin_dest}" />
	<mkdir dir="${src_dest}" />

	<echo message="UPDATE jdtcore.jar" />
	<jar 
		jarfile="${bin_dest}/jdtcore.jar"
		basedir="bin" 
		excludes="**/JDTCompilerAdapter.class"/>
		
	<echo message="UPDATE jdtCompilerAdapter.jar" />
	<jar 
		jarfile="${bin_dest}/jdtCompilerAdapter.jar"
		basedir="bin" 
		includes="**/JDTCompilerAdapter.class"/>

	<echo message="UPDATE plugin.xml" />
	<copy file="plugin.xml" todir="${bin_dest}" />
	<echo message="UPDATE plugin.properties" />
	<copy file="plugin.properties" todir="${bin_dest}" />

	<echo message="UPDATE .options" />
	<copy file=".options" todir="${bin_dest}" />

	<echo message="UPDATE about.html" />
	<copy file="about.html" todir="${bin_dest}" />

	<echo message="UPDATE jdtcoresrc.zip" />
	<zip zipfile="${src_dest}/jdtcoresrc.zip">
	    <zipfileset dir="antadapter" />
	    <zipfileset dir="batch" />
	    <zipfileset dir="codeassist" />
	    <zipfileset dir="compiler" />
	    <zipfileset dir="dom" />
	    <zipfileset dir="eval" />
	    <zipfileset dir="formatter" />
	    <zipfileset dir="model" />
	    <zipfileset dir="search" />
	</zip>		
</target>

</project>
